# renQoder PoC 빌드 개선 보고서 v14

## 📅 업데이트 일자
2026-02-07 (14차 개선)

## 🎯 개선 목표
- `ffprobe`의 텍스트 파싱 오류로 인해 영상 길이가 60분대로 오인식되던 문제를 근본적으로 해결합니다.
- 분수 형태의 FPS(예: 30/1) 데이터를 정확하게 계산하여 진행률의 정확도를 높입니다.

---

## ✨ 주요 개선 사항

### 1. JSON 포맷 ffprobe 분석 도입
이전의 CSV/Text 파싱 방식에서 발생하던 필드 밀림이나 규격 외 텍스트 간섭 문제를 해결하기 위해 **JSON 데이터 통신** 방식으로 전환했습니다.

- **정확한 재생 시간(Duration)**: `format` 섹션의 `duration` 값을 직접 참조하여, 2분 영상이 60분으로 튀던 현상을 완벽히 해결했습니다.
- **정확한 FPS 감지**: `r_frame_rate`의 분수 형태 필드를 수치로 자동 변환하여, 소수점 단위 오차까지 잡았습니다.
- **신뢰도 향상**: `ffprobe`가 제공하는 가장 표준적이고 상세한 데이터를 사용하여 정보 추출의 신뢰도를 높였습니다.

### 2. UI 정보 출력 및 예외 처리 강화
파일 선택 시 출력되는 정보의 가독성을 높이고, 분석 실패 시의 안전장치를 마련했습니다.

- **단위 변환**: 재생 시간을 "분/초" 형태로 더 직관적으로 표시합니다.
- **유효성 검사**: 분석 데이터가 누락될 경우 "알 수 없음"으로 표시하여 프로그램이 예외 상황에서도 중단되지 않도록 보호합니다.
- **로그 정밀화**: FPS 수치를 소수점 2자리까지 정밀하게 표시하여 엔진의 분석 상태를 명확히 보여줍니다.

---

## 📝 코드 변경 사항

### 1. `src/renqoder/encoder.py`
- `get_video_info`: `ffprobe -print_format json` 호출 및 `json.loads()`를 통한 데이터 추출 로직으로 전면 개편.
- 비동기 보정: `nb_frames` 누락 시 `duration * fps` 자동 계산 로직 적용.

### 2. `src/renqoder/main.py`
- `select_file`: JSON 기반 인코더 정보를 활용하여 로그창의 파일 정보 출력 로직을 직관적으로 개선.

---

## 🧪 테스트 결과

- **재생 시간 감지**: 2분 0.87초 영상이 정확히 "2분 0초" (120초)대로 인식됨을 로그창에서 확인. ✅
- **FPS 감지**: 30.00fps로 명시된 수치가 정확히 로그에 기록됨을 확인. ✅
- **진행률 바**: 정확해진 분모(Duration) 값을 바탕으로 진행률이 더 이상 왜곡되지 않고 부드럽게 상승함. ✅

---

## 🎉 결론

이번 14차 개선을 통해 **renQoder**는 FFmpeg/ffprobe로부터 데이터를 읽어오는 **"눈"**을 훨씬 정교하게 업그레이드했습니다. 이제 어떠한 특수 포맷의 영상이라도 수치적 오해 없이 정확하게 처리할 수 있는 기반이 마련되었습니다. 🚀
