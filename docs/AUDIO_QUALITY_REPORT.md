# renQoder PoC 빌드 개선 보고서 v7

## 📅 업데이트 일자
2026-02-07 (7차 개선)

## 🎯 개선 목표
오디오 원본 유지(Copy) 모드에서도 파일명에 코덱 정보뿐만 아니라 **비트레이트(품질) 정보를 포함**하여, 출력 파일의 스펙을 파일명만으로 더 명확하게 파악할 수 있도록 합니다.

---

## ✨ 주요 개선 사항

### 1. 원본 오디오 비트레이트 감지 및 파일명 반영

#### 변경 내용
`ffprobe`를 통해 원본 파일의 오디오 비트레이트(`bit_rate`)를 추출하여 파일명에 자동으로 포함합니다.

**Before (v6):**
- 원본 유지 시: `video_NVENC_CQ23_AAC.mkv` (품질 정보 미비)
- AAC 변환 시: `video_NVENC_CQ23_AAC192k.mp4`

**After (v7):**
- 원본 유지 시: `video_NVENC_CQ23_AAC320k.mkv` ✨ (원본이 320kbps인 경우)
- 원본 유지 시: `video_NVENC_CQ23_AC3640k.mkv` ✨ (원본이 640kbps인 경우)
- 비트레이트 추출 실패 시: `video_NVENC_CQ23_AAC.mkv` (기존과 동일하게 폴백)

### 2. 오디오 정보 추출 로직 업그레이드

- **`get_audio_info` 메서드 신설**: 코덱명과 비트레이트를 한 번에 분석하여 반환합니다.
- **가독성 최적화**: `320000` bps와 같은 로우 데이터를 `320k`와 같이 직관적인 단위로 변환하여 파일명에 사용합니다.
- **다양한 코덱 지원**: AAC, AC3, DTS, TrueHD, FLAC, Opus 등 주요 오디오 코덱에 대해 최적화된 표시 이름을 지원합니다.

---

## 📝 코드 변경 사항

### 1. `src/renqoder/encoder.py`
- `get_audio_codec` 메서드를 `get_audio_info`로 대체.
- `ffprobe` 명령어 인자 수정 (`bit_rate` 필드 추가).
- 비트레이트 산출 및 단위 변환(`kbps`) 로직 구현.
- `generate_output_filename`에서 `get_audio_info`를 호출하도록 수정.

---

## 🧪 테스트 완료

- **AAC 변환 케이스**: 기존과 동일하게 `AAC192k` 정상 출력 확인.
- **원본 유지 케이스**: 실제 미디어 파일 환경에서 코덱명 뒤에 비트레이트가 붙는 구조 확인.
- **에러 핸들링**: 비트레이트 정보가 없는 스트림(VBR 등 특정 케이스)의 경우 코덱명만 표시하도록 안정 장치 마련.

---

## 💡 사용자 혜택

1. **완성도 높은 메타데이터**: 출력 파일의 이름을 통해 비디오 품질(CQ)뿐만 아니라 오디오 품질(Bitrate)까지 한눈에 확인 가능합니다.
2. **원본 보존 여부 확인**: 원본 비트레이트가 그대로 파일명에 표시되므로, 데이터가 손실 없이 유지되었는지 직관적으로 알 수 있습니다.

---

## 🎉 결론

이번 개선을 통해 **renQoder**의 스마트 파일명 시스템이 더욱 정교해졌습니다. 사용자는 이제 비디오와 오디오 양쪽 모두의 품질 정보를 파일명에서 즉시 확인할 수 있습니다. 🚀
