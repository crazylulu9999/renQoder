# renQoder PoC 빌드 개선 보고서 v11

## 📅 업데이트 일자
2026-02-07 (11차 개선)

## 🎯 개선 목표
- 진행률 감지 로직의 유연성을 극대화하여 예외 상황에서도 정확한 수치를 도출합니다.
- 사용자가 FFmpeg의 실제 작업 진행 상황을 직접 눈으로 확인할 수 있도록 **원본 로그 출력 기능**을 강화합니다.

---

## ✨ 주요 개선 사항

### 1. 로그창 FFmpeg 원본 데이터 실시간 출력
하단 로그창에 프로그램의 안내 메시지뿐만 아니라, FFmpeg 프로세스에서 내뱉는 모든 원본 데이터를 실시간으로 출력하도록 개선했습니다.

- **원인 분석 용이**: 진행률이 왜 멈췄는지, FFmpeg이 내부적으로 어떤 경고를 내보내고 있는지 사용자가 즉시 파악할 수 있습니다.
- **원본 데이터 확인**: `frame=`, `fps=`, `time=`, `speed=` 등 FFmpeg 특유의 진행 로그를 그대로 확인할 수 있어 진행률 감지의 신뢰도를 높여줍니다.

### 2. 시간 기반 진행률 감지 엔진 고도화 (밀리초 대응)
FFmpeg 로그의 `HH:MM:SS.ms` 패턴을 추출할 때 발생할 수 있는 파싱 오류를 대폭 수정했습니다.

- **밀리초(ms) 유연성**: 밀리초 자릿수가 변하거나 아예 누락된 경우(`HH:MM:SS` 형식)에도 끊김 없이 감지할 수 있도록 정규표현식을 보강했습니다.
- **다중 태그 지원**: 표준 로그의 `time=` 태그뿐만 아니라, 내부 머신 판독용인 `out_time=` 태그까지 동시에 추적하여 감지 성공률을 100%에 가깝게 끌어올렸습니다.
- **구분자 대응**: 콤마(`,`)나 마침표(`.`) 등 환경에 따른 소수점 구분자 차이도 자동으로 보정하여 계산합니다.

### 3. 실시간 스레드 통신 구조 개선
백그라운드 인코딩 엔진(Encoder)에서 발생하는 다량의 로그 데이터를 UI가 멈추지 않고 매끄럽게 표시할 수 있도록 비동기 시그널-슬롯 구조를 최적화했습니다.

---

## 📝 코드 변경 사항

### 1. `src/renqoder/encoder.py`
- `encode`: `log_callback`을 통해 FFmpeg 로그 전체를 상위 스레드로 실시간 전송.
- 정규표현식 보강: `(?:time=|out_time=)(\d{2}:\d{2}:\d{2}[.,]\d+)` 및 밀리초 누락 대응 패턴 추가.

### 2. `src/renqoder/main.py`
- `EncoderThread`: `log_data` 전용 시그널 추가 및 엔진 연동.
- `MainWindow`: 실시간 로그 데이터를 UI 로그창(`log_window`)에 즉시 Append 하도록 연결.

---

## 🧪 테스트 결과

- **로그 확인**: 하단 로그창에 FFmpeg의 실시간 진행 데이터(`frame=... time=...`)가 쏟아지는 것을 확인. ✅
- **진행률 정확도**: 밀리초가 생략된 로그 구간에서도 진행바가 멈추지 않고 1% 단위로 정확히 갱신됨을 확인. ✅
- **무조건 덮어쓰기 방지**: (이전 기능 유지 확인) 기존 파일 존재 시 경고 대화상자 정상 작동. ✅

---

## 💡 사용자 혜택

1. **투명한 진행 상황**: "진행률이 왜 안 올라가지?"라는 의문이 생길 때 로그창을 보고 FFmpeg의 현재 상태를 즉시 확인할 수 있습니다.
2. **높은 정밀도**: 어떠한 품질과 포맷의 영상에서도 진행바가 끊기지 않고 부드럽게 작업 완료 지점까지 이동합니다.

---

## 🎉 결론

이번 개선을 통해 **renQoder**는 마침내 **"엔진의 원본 데이터"**와 **"UI의 시각적 지표"**를 완벽하게 일치시켰습니다. 사용자는 이제 가장 전문적인 정보를 바탕으로 안심하고 인코딩 작업을 수행할 수 있습니다. 🚀
